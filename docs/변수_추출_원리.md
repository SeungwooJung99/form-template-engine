# FreeMarker ë³€ìˆ˜ ì¶”ì¶œ ì™„ì „ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨

1. [ë¬¸ì œ ì •ì˜](#ë¬¸ì œ-ì •ì˜)
2. [ì„¸ ê°€ì§€ ì ‘ê·¼ë²• ë¹„êµ](#ì„¸-ê°€ì§€-ì ‘ê·¼ë²•-ë¹„êµ)
3. [ì •ê·œì‹ ê¸°ë°˜ ì ‘ê·¼ë²•](#ì •ê·œì‹-ê¸°ë°˜-ì ‘ê·¼ë²•)
4. [AST ê¸°ë°˜ ì ‘ê·¼ë²•](#ast-ê¸°ë°˜-ì ‘ê·¼ë²•)
5. [Enhanced Mock Environment ì ‘ê·¼ë²•](#enhanced-mock-environment-ì ‘ê·¼ë²•)
6. [ì‹¤ì œ ë™ì‘ ì›ë¦¬ ì‹œì—°](#ì‹¤ì œ-ë™ì‘-ì›ë¦¬-ì‹œì—°)
7. [ê¸°ì—…ìš© FreeMarker í…œí”Œë¦¿ ì‘ì„± ê·œì¹™](#ê¸°ì—…ìš©-freemarker-í…œí”Œë¦¿-ì‘ì„±-ê·œì¹™)
8. [ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­](#ê²°ë¡ -ë°-ê¶Œì¥ì‚¬í•­)

---

## ğŸ¯ ë¬¸ì œ ì •ì˜

FreeMarker í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©ë˜ëŠ” **ëª¨ë“  ë³€ìˆ˜ë¥¼ ì •í™•í•˜ê²Œ ì¶”ì¶œ**í•˜ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ë¡œ ì¤‘ìš”í•©ë‹ˆë‹¤:

- **í…œí”Œë¦¿ ë Œë”ë§ì„ ìœ„í•œ í•„ìˆ˜ ë°ì´í„° ì¤€ë¹„**
- **í…œí”Œë¦¿ ì˜ì¡´ì„± ë¶„ì„ ë° ë¬¸ì„œí™”**
- **ëŸ°íƒ€ì„ ì˜¤ë¥˜ ë°©ì§€**
- **ê°œë°œ ë„êµ¬ ì§€ì› (ìë™ì™„ì„±, ê²€ì¦ ë“±)**

### ì£¼ìš” ë„ì „ê³¼ì œ

- ì¡°ê±´ë¶€ ë¶„ê¸°ì—ì„œì˜ ë³€ìˆ˜ ì‚¬ìš©
- ë™ì  ë³€ìˆ˜ëª… ë° í•„ë“œ ì ‘ê·¼
- ë§¤í¬ë¡œì™€ í•¨ìˆ˜ ë‚´ë¶€ì˜ ë³€ìˆ˜
- ë³µì¡í•œ í‘œí˜„ì‹ê³¼ ë‚´ì¥ í•¨ìˆ˜
- FreeMarker ì—°ì‚°ìì™€ ì‹¤ì œ ë³€ìˆ˜ì˜ êµ¬ë¶„

---

## ğŸ” ì„¸ ê°€ì§€ ì ‘ê·¼ë²• ë¹„êµ

| ì ‘ê·¼ë²•                           | ì •í™•ì„±   | ì•ˆì •ì„±   | ìœ ì§€ë³´ìˆ˜ì„± | ì„±ëŠ¥    | ê¸°ì—… ì í•©ì„± |
|-------------------------------|-------|-------|-------|-------|--------|
| **ì •ê·œì‹ ê¸°ë°˜**                    | â­â­    | â­â­    | â­     | â­â­â­â­â­ | âŒ      |
| **AST ê¸°ë°˜**                    | â­â­â­   | â­â­â­   | â­â­    | â­â­â­   | âš ï¸     |
| **Enhanced Mock Environment** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­  | â­â­â­â­  | âœ…      |

---

## ğŸ“ ì •ê·œì‹ ê¸°ë°˜ ì ‘ê·¼ë²•

### ì‘ë™ ì›ë¦¬

```java
// ì •ê·œì‹ìœ¼ë¡œ ${...} íŒ¨í„´ì„ ì°¾ìŒ
Pattern dollarPattern = Pattern.compile("\\$\\{([^}]+)\\}");
Matcher matcher = dollarPattern.matcher(templateContent);

while(matcher.

find()){
String expression = matcher.group(1);  // "company.name"

// ë¬¸ìì—´ íŒŒì‹±ìœ¼ë¡œ ë³€ìˆ˜ëª… ì¶”ì¶œ ì‹œë„
extractVariablesFromExpression(expression);
}
```

### ì²˜ë¦¬ ì˜ˆì‹œ

```ftl
<!-- í…œí”Œë¦¿ ë‚´ìš© -->
<#if items?? && items?has_content>
    <#list items as item>
        ${item.name!"Unknown"}
        <#if item.price gt 1000>
            ${item.discount}
        </#if>
    </#list>
</#if>
```

**ì •ê·œì‹ì˜ ì²˜ë¦¬:**

- âœ… `${item.name!"Unknown"}` â†’ "item.name" ì¶”ì¶œ
- âœ… `${item.discount}` â†’ "item.discount" ì¶”ì¶œ
- âŒ `item.price gt 1000`ì—ì„œ "gt"ë¥¼ ë³€ìˆ˜ë¡œ ì˜¤ì¸
- âŒ ì¡°ê±´ë¬¸ ì•ˆì˜ ë³€ìˆ˜(`item.price`)ëŠ” ë†“ì¹  ìˆ˜ ìˆìŒ

### ì •ê·œì‹ì˜ í•œê³„

#### ë³µì¡í•œ ì¼€ì´ìŠ¤ë“¤

```ftl
<!-- ë©”ì„œë“œ í˜¸ì¶œ -->
${user.getName()}

<!-- ë™ì  ì ‘ê·¼ -->
${items[index].properties["key"]}

<!-- ì‚¼í•­ ì—°ì‚°ì -->
${condition ? value1 : value2}

<!-- ë¬¸ìì—´ ì—°ê²° -->
${"Hello " + user.name}

<!-- ë™ì  ë§¤í¬ë¡œ í˜¸ì¶œ -->
${macro.callDynamic()}
```

#### ì£¼ìš” ë¬¸ì œì 

- ğŸ”´ **ë¬¸ë§¥ì„ ëª¨ë¦„**: ë¬¸ìì—´ì¼ ë¿, ì˜ë¯¸ë¥¼ ì´í•´í•˜ì§€ ëª»í•¨
- ğŸ”´ **ì¡°ê±´ë¶€ ì‹¤í–‰ ë¬´ì‹œ**: ifë¬¸ ì•ˆì˜ ë³€ìˆ˜ë¥¼ ë†“ì¹  ìˆ˜ ìˆìŒ
- ğŸ”´ **ë™ì  ë³€ìˆ˜ëª… ì²˜ë¦¬ ë¶ˆê°€**: ëŸ°íƒ€ì„ì— ê²°ì •ë˜ëŠ” ë³€ìˆ˜
- ğŸ”´ **ì—°ì‚°ìì™€ ë³€ìˆ˜ êµ¬ë¶„ ì–´ë ¤ì›€**: gt, lt ë“±ì„ ë³€ìˆ˜ë¡œ ì˜¤ì¸
- ğŸ”´ **ë§¤í¬ë¡œ/í•¨ìˆ˜ ë‚´ë¶€ ë¶„ì„ í•œê³„**: ë³µì¡í•œ ë¡œì§ ì¶”ì  ë¶ˆê°€

---

## ğŸŒ³ AST ê¸°ë°˜ ì ‘ê·¼ë²•

### ì‘ë™ ì›ë¦¬

```java
// FreeMarkerê°€ í…œí”Œë¦¿ì„ íŒŒì‹±í•˜ì—¬ ìƒì„±í•˜ëŠ” êµ¬ë¬¸ íŠ¸ë¦¬
Template template = freeMarkerConfig.getTemplate("invoice.ftl");
// template ë‚´ë¶€ì—ëŠ” ASTê°€ ìˆìŒ

// AST ë…¸ë“œ êµ¬ì¡° ì˜ˆì‹œ:
// RootNode
//   â”œâ”€â”€ IfBlock
//   â”‚   â”œâ”€â”€ Condition: "items?? && items?has_content"
//   â”‚   â””â”€â”€ Body
//   â”‚       â””â”€â”€ ListDirective
//   â”‚           â”œâ”€â”€ Sequence: "items" 
//   â”‚           â”œâ”€â”€ LoopVar: "item"
//   â”‚           â””â”€â”€ Body
//   â”‚               â””â”€â”€ PrintNode: "${item.name}"
//   â””â”€â”€ ...
```

### AST ë¶„ì„ ì˜ˆì‹œ

```ftl
<#if company??>
    ${company.name}
    <#if company.address?has_content>
        ${company.address}
    </#if>
</#if>
```

**AST ë¶„ì„ ê²°ê³¼:**

```
IfDirective
â”œâ”€â”€ condition: "company??"
â”‚   â””â”€â”€ ë³€ìˆ˜: "company" âœ…
â””â”€â”€ body:
    â”œâ”€â”€ PrintDirective: "${company.name}"
    â”‚   â””â”€â”€ ë³€ìˆ˜: "company.name" âœ…
    â””â”€â”€ IfDirective
        â”œâ”€â”€ condition: "company.address?has_content"
        â”‚   â””â”€â”€ ë³€ìˆ˜: "company.address" âœ…
        â””â”€â”€ body:
            â””â”€â”€ PrintDirective: "${company.address}"
                â””â”€â”€ ë³€ìˆ˜: "company.address" âœ…
```

### ASTì˜ ì¥ì 

- âœ… **êµ¬ë¬¸ êµ¬ì¡° ì •í™• íŒŒì•…**: FreeMarker ë¬¸ë²•ì„ ì™„ë²½ ì´í•´
- âœ… **ì—°ì‚°ì êµ¬ë¶„**: gt, lt ë“±ì„ ë³€ìˆ˜ë¡œ ì˜¤ì¸í•˜ì§€ ì•ŠìŒ
- âœ… **ë§¤í¬ë¡œ/í•¨ìˆ˜ ì •ì˜ ì¶”ì¶œ**: í…œí”Œë¦¿ êµ¬ì¡° ë¶„ì„ ê°€ëŠ¥
- âœ… **ì¤‘ì²© êµ¬ì¡° ì²˜ë¦¬**: ë³µì¡í•œ if/list ì¤‘ì²© ì²˜ë¦¬

### ASTì˜ í•œê³„

#### ASTê°€ ë†“ì¹˜ëŠ” ì¼€ì´ìŠ¤ë“¤

```ftl
<!-- ë™ì  ë³€ìˆ˜ ì ‘ê·¼ -->
<#assign dynamicVar = "company">
${.vars[dynamicVar].name}

<!-- ì¡°ê±´ë¶€ ë¶„ê¸° -->
<#if condition>
    ${variableA}
<#else>
    ${variableB}
</#if>

<!-- ëŸ°íƒ€ì„ ê²°ì • í•„ë“œ -->
<#list items as item>
    ${item[user.selectedField]}
</#list>

<!-- ë³µì¡í•œ í‘œí˜„ì‹ -->
${items?filter(item -> item.price > threshold)?map(item -> item.name)}
```

#### ì£¼ìš” ë¬¸ì œì 

- ğŸŸ¡ **ì •ì  ë¶„ì„ì˜ í•œê³„**: ëŸ°íƒ€ì„ ë™ì‘ì„ ì˜ˆì¸¡í•  ìˆ˜ ì—†ìŒ
- ğŸŸ¡ **ì¡°ê±´ë¶€ ë¶„ê¸°**: ì–´ë–¤ ì¡°ê±´ì´ ì‹¤í–‰ë ì§€ ëª¨ë¦„
- ğŸŸ¡ **ë™ì  ë³€ìˆ˜ëª…**: ì‹¤í–‰ ì‹œì ì— ê²°ì •ë˜ëŠ” ë³€ìˆ˜
- ğŸŸ¡ **ë³µì¡í•œ í‘œí˜„ì‹**: ê³„ì‚°ëœ í•„ë“œëª…, ë™ì  ì ‘ê·¼

---

## ğŸ­ Enhanced Mock Environment ì ‘ê·¼ë²•

### í•µì‹¬ ì•„ì´ë””ì–´

**"FreeMarker ì—”ì§„ì—ê²Œ ì§ì ‘ ë¬¼ì–´ë³´ì"**

```java
// ì‹¤ì œ FreeMarker ì—”ì§„ì„ ì‹¤í–‰í•˜ë˜, 
// ëª¨ë“  ë³€ìˆ˜ ì ‘ê·¼ì„ ì¶”ì í•˜ëŠ” Mock ê°ì²´ ì œê³µ
template.process(mockDataModel, writer);
```

### Enhanced ì „ëµ

1. **ê¸°ë³¸ Mock Environment**: í‘œì¤€ ì‹¤í–‰
2. **ì¡°ê±´ë¬¸ Mock Environment**: ë‹¤ë¥¸ ë¶„ê¸° ì‹¤í–‰
3. **ë°˜ë³µë¬¸ Mock Environment**: ì—¬ëŸ¬ ì•„ì´í…œ ì‹œë®¬ë ˆì´ì…˜
4. **ë‹¤ì¤‘ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**: ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ ì»¤ë²„

### êµ¬í˜„ ì½”ë“œ

#### Step 1: Mock Model ìƒì„±

```java
class VariableCapturingModel implements TemplateHashModel {
    private Set<String> accessedVariables = new LinkedHashSet<>();

    @Override
    public TemplateModel get(String key) {
        // FreeMarkerê°€ ë³€ìˆ˜ì— ì ‘ê·¼í•  ë•Œë§ˆë‹¤ í˜¸ì¶œë¨
        accessedVariables.add(key);        // ğŸ“ ì ‘ê·¼ëœ ë³€ìˆ˜ ê¸°ë¡

        // ì¤‘ì²© ê°ì²´ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ Mock ë°˜í™˜
        return new NestedCapturingModel(key, accessedVariables);
    }
}
```

#### Step 2: Enhanced ì‹¤í–‰ ê³¼ì •

```java
private Set<String> extractVariablesUsingEnhancedMockEnvironment(String templateName) {
    Set<String> allVariables = new LinkedHashSet<>();

    // === 1ë‹¨ê³„: ê¸°ë³¸ ì‹¤í–‰ ===
    BasicMock basicMock = new BasicMock();
    template.process(basicMock, writer);
    allVariables.addAll(basicMock.getAccessedVariables());

    // === 2ë‹¨ê³„: ì¡°ê±´ë¬¸ì„ ìœ„í•œ ë°˜ëŒ€ ì‹¤í–‰ ===
    ConditionalMock reverseMock = new ConditionalMock();
    reverseMock.setInvertConditions(true);  // ëª¨ë“  ì¡°ê±´ì„ ë°˜ëŒ€ë¡œ
    template.process(reverseMock, writer);
    allVariables.addAll(reverseMock.getAccessedVariables());

    // === 3ë‹¨ê³„: ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ” ê²½ìš° ===
    EmptyListMock emptyMock = new EmptyListMock();
    template.process(emptyMock, writer);
    allVariables.addAll(emptyMock.getAccessedVariables());

    // === 4ë‹¨ê³„: í° ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš° ===
    LargeListMock largeMock = new LargeListMock();
    template.process(largeMock, writer);
    allVariables.addAll(largeMock.getAccessedVariables());

    return allVariables;
}
```

### Enhanced Mockì˜ ê°•ë ¥í•¨

#### ì¼€ì´ìŠ¤ 1: ë™ì  ë³€ìˆ˜ ì ‘ê·¼

```ftl
<#assign field = "name">
${company[field]}
```

**Mock Environment ì²˜ë¦¬:**

```java
// 1. FreeMarker: "field ë³€ìˆ˜ì˜ ê°’ì€?"
mockModel.get("field") â†’ "name"ë°˜í™˜ +ê¸°ë¡

// 2. FreeMarker: "company['name']ì— ì ‘ê·¼"
companyMock.

get("name") â†’ê¸°ë¡
```

**ê²°ê³¼**: `company`, `field`, `company.name` ëª¨ë‘ ì¶”ì¶œ âœ…

#### ì¼€ì´ìŠ¤ 2: ì¡°ê±´ë¶€ ë¶„ê¸°

```ftl
<#if user.type == "admin">
    ${admin.permissions}
<#else>
    ${user.basicInfo}
</#if>
```

**Multiple Scenario Testing:**

```java
// ì‹œë‚˜ë¦¬ì˜¤ 1: adminì¸ ê²½ìš°
adminMock.get("user").

get("type") â†’ "admin"ë°˜í™˜
â†’
admin.permissions ì ‘ê·¼ë¨

// ì‹œë‚˜ë¦¬ì˜¤ 2: ì¼ë°˜ ìœ ì €ì¸ ê²½ìš°  
userMock.

get("user").

get("type") â†’ "user"ë°˜í™˜
â†’
user.basicInfo ì ‘ê·¼ë¨
```

**ê²°ê³¼**: ëª¨ë“  ë¶„ê¸°ì˜ ë³€ìˆ˜ê°€ ì¶”ì¶œë¨ âœ…

#### ì¼€ì´ìŠ¤ 3: ë³µì¡í•œ í‘œí˜„ì‹

```ftl
${items?filter(item -> item.price > threshold)?map(item -> item.name)}
```

**Mock Environment ì²˜ë¦¬:**

```java
// FreeMarkerê°€ ì‹¤ì œë¡œ filterì™€ mapì„ ì‹¤í–‰í•˜ë ¤ê³  ì‹œë„
// ê·¸ ê³¼ì •ì—ì„œ item.priceì™€ item.nameì— ì ‘ê·¼
// threshold ë³€ìˆ˜ì—ë„ ì ‘ê·¼
```

**ê²°ê³¼**: `items`, `threshold`, `item.price`, `item.name` ëª¨ë‘ ì¶”ì¶œ âœ…

---

## ğŸ¬ ì‹¤ì œ ë™ì‘ ì›ë¦¬ ì‹œì—°

### í…œí”Œë¦¿ ì˜ˆì‹œ

```ftl
<#if company??>
    Company: ${company.name}
    <#if company.address?has_content>
        Address: ${company.address}
    </#if>
    
    <#list items as item>
        Item: ${item.name}
        <#if item.price gt 1000>
            Expensive item! Discount: ${item.discount}
        </#if>
    </#list>
</#if>
```

### FreeMarker ì‹¤í–‰ ê³¼ì • ì‹œë®¬ë ˆì´ì…˜

#### Step 1: ì´ˆê¸° ì¡°ê±´ ì²´í¬

```
ğŸš€ FreeMarker ì—”ì§„ ì‹œì‘...

1. FreeMarker: 'company' ë³€ìˆ˜ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
   â†’ mockModel.get("company") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'company' ê¸°ë¡ë¨ âœ…
```

#### Step 2: ì¤‘ì²© ì†ì„± ì ‘ê·¼

```
2. companyê°€ ì¡´ì¬í•˜ë¯€ë¡œ ifë¬¸ ì§„ì…

3. FreeMarker: 'company.name' ì¶œë ¥ ì‹œë„
   â†’ companyModel.get("name") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'company.name' ê¸°ë¡ë¨ âœ…
```

#### Step 3: í•˜ìœ„ ì¡°ê±´ ì²˜ë¦¬

```
4. FreeMarker: 'company.address'ì˜ has_content ì²´í¬
   â†’ companyModel.get("address") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'company.address' ê¸°ë¡ë¨ âœ…
```

#### Step 4: ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ ì²˜ë¦¬

```
5. FreeMarker: 'items' ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ ì²˜ë¦¬
   â†’ mockModel.get("items") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'items' ê¸°ë¡ë¨ âœ…

6. FreeMarker: ì²« ë²ˆì§¸ ì•„ì´í…œ ì²˜ë¦¬
7. FreeMarker: 'item.name' ì¶œë ¥
   â†’ itemModel.get("name") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'item.name' ê¸°ë¡ë¨ âœ…
```

#### Step 5: ì¡°ê±´ë¬¸ ì²˜ë¦¬

```
8. FreeMarker: 'item.price > 1000' ì¡°ê±´ ì²´í¬
   â†’ itemModel.get("price") í˜¸ì¶œë¨
   â†’ ë³€ìˆ˜ 'item.price' ê¸°ë¡ë¨ âœ…

9. price > 1000ì´ë¯€ë¡œ ì¡°ê±´ë¬¸ ì§„ì…
10. FreeMarker: 'item.discount' ì¶œë ¥
    â†’ itemModel.get("discount") í˜¸ì¶œë¨
    â†’ ë³€ìˆ˜ 'item.discount' ê¸°ë¡ë¨ âœ…
```

### ìµœì¢… ì¶”ì¶œ ê²°ê³¼

```
âœ… company
âœ… company.name
âœ… company.address
âœ… items
âœ… item.name
âœ… item.price
âœ… item.discount
```

### ë‹¤ë¥¸ ë°©ì‹ê³¼ì˜ ë¹„êµ

#### ì •ê·œì‹ ë°©ì‹

```
ğŸ“ ì •ê·œì‹ ë°©ì‹:
ì •ê·œì‹ ê²°ê³¼:
âœ… item.discount
âŒ 'item.price'ëŠ” ì¡°ê±´ë¬¸ì— ìˆì–´ì„œ ë†“ì¹¨!
âŒ 'gt'ë¥¼ ë³€ìˆ˜ë¡œ ì˜¤ì¸í•  ìœ„í—˜!
```

#### AST ë°©ì‹

```
ğŸŒ³ AST ë°©ì‹:
ASTê°€ ë³´ëŠ” ê²ƒ:
- PrintDirective: ${company[field]}
- ë³€ìˆ˜: company, field
âŒ í•˜ì§€ë§Œ company.nameì´ ì‹¤ì œë¡œ ì ‘ê·¼ëœë‹¤ëŠ” ê±¸ ëª¨ë¦„!

Mock Environmentê°€ ë³´ëŠ” ê²ƒ:
âœ… company
âœ… field  
âœ… company.name (ëŸ°íƒ€ì„ì— ì‹¤ì œ ì ‘ê·¼ë¨!)
```

---

## ğŸ“– ê¸°ì—…ìš© FreeMarker í…œí”Œë¦¿ ì‘ì„± ê·œì¹™

### ğŸ¯ í•µì‹¬ ì›ì¹™

#### 1. ë³€ìˆ˜ëª… ê·œì¹™

```ftl
<!-- âœ… ì¢‹ì€ ì˜ˆ -->
${company.name}
${client.contactPerson}
${invoice.items}

<!-- âŒ ë‚˜ìœ ì˜ˆ -->
${c.n}
${clientContactPerson}  <!-- ë„ˆë¬´ í‰ë©´ì  -->
${invoice_items}        <!-- ì–¸ë”ìŠ¤ì½”ì–´ ëŒ€ì‹  ì  í‘œê¸°ë²• ì‚¬ìš© -->
```

#### 2. ê³„ì¸µ êµ¬ì¡° ì¤€ìˆ˜

```ftl
<!-- âœ… ê¶Œì¥: ëª…í™•í•œ ê³„ì¸µ êµ¬ì¡° -->
${company.name}
${company.address}
${company.phone}

${client.name}
${client.address}

<!-- âŒ ë¹„ê¶Œì¥: í‰ë©´ì  êµ¬ì¡° -->
${companyName}
${companyAddress}
${clientName}
${clientAddress}
```

### ğŸ“ ë³€ìˆ˜ ì‚¬ìš© ê·œì¹™

#### 3. ì•ˆì „í•œ ë³€ìˆ˜ ì ‘ê·¼

```ftl
<!-- âœ… í•­ìƒ null ì²´í¬ì™€ ê¸°ë³¸ê°’ ì‚¬ìš© -->
${company.name!"ê¸°ë³¸ íšŒì‚¬ëª…"}
${client.phone!"-"}

<!-- âœ… has_content ì²´í¬ -->
<#if company?? && company.name?has_content>
    ${company.name}
</#if>

<!-- âŒ ì§ì ‘ ì ‘ê·¼ (NullPointerException ìœ„í—˜) -->
${company.name}
```

#### 4. ë¦¬ìŠ¤íŠ¸/ë°°ì—´ ì²˜ë¦¬

```ftl
<!-- âœ… ì•ˆì „í•œ ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ -->
<#if items?? && items?has_content>
    <#list items as item>
        ${item.name!"Unknown"}
        ${item.quantity!0}
    </#list>
<#else>
    <p>í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
</#if>

<!-- âŒ ì²´í¬ ì—†ëŠ” ë¦¬ìŠ¤íŠ¸ ì²˜ë¦¬ -->
<#list items as item>
    ${item.name}
</#list>
```

#### 5. ì¡°ê±´ë¬¸ ê·œì¹™

```ftl
<!-- âœ… ëª…í™•í•œ ì¡°ê±´ë¬¸ -->
<#if discount?? && discount gt 0>
    <p>í• ì¸: ${discount}%</p>
</#if>

<#if client?? && client?is_hash>
    ${client.name!"Unknown Client"}
</#if>

<!-- âŒ ë³µì¡í•œ ì¡°ê±´ë¬¸ -->
<#if (discount?? && discount gt 0) || (client?? && client.vip?? && client.vip == true)>
```

### ğŸ”§ ë§¤í¬ë¡œì™€ í•¨ìˆ˜ ê·œì¹™

#### 6. ì•ˆì „í•œ ë§¤í¬ë¡œ ì‘ì„±

```ftl
<!-- âœ… ë§¤ê°œë³€ìˆ˜ ê²€ì¦ì´ ìˆëŠ” ë§¤í¬ë¡œ -->
<#macro formatCurrency amount defaultValue=0>
    <#if amount??>
        <#if amount?is_number>
            â‚©${amount?string("#,##0")}
        <#else>
            â‚©${defaultValue?string("#,##0")}
        </#if>
    <#else>
        â‚©${defaultValue?string("#,##0")}
    </#if>
</#macro>

<!-- âœ… ì‚¬ìš©ë²• -->
<@formatCurrency amount=item.price defaultValue=0 />
```

#### 7. í•¨ìˆ˜ ì •ì˜ ê·œì¹™

```ftl
<!-- âœ… íƒ€ì… ì²´í¬ê°€ ìˆëŠ” í•¨ìˆ˜ -->
<#function safeNumber value defaultValue=0>
    <#if value??>
        <#if value?is_number>
            <#return value>
        <#elseif value?is_string>
            <#attempt>
                <#return value?number>
            <#recover>
                <#return defaultValue>
            </#attempt>
        </#if>
    </#if>
    <#return defaultValue>
</#function>
```

### ğŸ“… ë‚ ì§œ ì²˜ë¦¬ ê·œì¹™

#### 8. ì•ˆì „í•œ ë‚ ì§œ í¬ë§·íŒ…

```ftl
<!-- âœ… ë‚ ì§œ íƒ€ì… ì²´í¬ -->
<#if issueDate??>
    <#if issueDate?is_date>
        ${issueDate?string("yyyy-MM-dd")}
    <#else>
        ${issueDate?string}
    </#if>
<#else>
    ë¯¸ì§€ì •
</#if>

<!-- âœ… í˜„ì¬ ë‚ ì§œ ì‚¬ìš© -->
${.now?string("yyyy-MM-dd HH:mm")}
```

### ğŸš« ê¸ˆì§€ ì‚¬í•­

#### 9. ì‚¬ìš©í•˜ì§€ ë§ì•„ì•¼ í•  íŒ¨í„´

```ftl
<!-- âŒ ì§ì ‘ null ì ‘ê·¼ -->
${variable}  <!-- variableì´ nullì¼ ìˆ˜ ìˆìŒ -->

<!-- âŒ ë³µì¡í•œ ì¸ë¼ì¸ ì—°ì‚° -->
${(item.price * item.quantity * (1 + taxRate/100))?string("#,##0")}

<!-- âŒ í•˜ë“œì½”ë”©ëœ ì¸ë±ìŠ¤ -->
${items[0].name}  <!-- itemsê°€ ë¹„ì–´ìˆì„ ìˆ˜ ìˆìŒ -->

<!-- âŒ ì¤‘ì²©ëœ ì‚¼í•­ ì—°ì‚°ì -->
${condition1 ? (condition2 ? value1 : value2) : value3}

<!-- âŒ ë¬¸ìì—´ ì—°ì‚°ì—ì„œ null ìœ„í—˜ -->
${"Total: " + amount}  <!-- amountê°€ nullì´ë©´ "Total: null" -->
```

### âœ… ê¶Œì¥ íŒ¨í„´

#### 10. ì•ˆì „í•œ ëŒ€ì•ˆë“¤

```ftl
<!-- âœ… ì•ˆì „í•œ ê¸°ë³¸ê°’ -->
${variable!"ê¸°ë³¸ê°’"}

<!-- âœ… ë§¤í¬ë¡œë¡œ ë³µì¡í•œ ì—°ì‚° ë¶„ë¦¬ -->
<@calculateTotal item=item taxRate=taxRate />

<!-- âœ… ì•ˆì „í•œ ë°°ì—´ ì ‘ê·¼ -->
<#if items?? && items?size gt 0>
    ${items[0].name!"Unknown"}
</#if>

<!-- âœ… ëª…í™•í•œ ì¡°ê±´ë¬¸ -->
<#if condition1>
    <#if condition2>
        ${value1}
    <#else>
        ${value2}
    </#if>
<#else>
    ${value3}
</#if>

<!-- âœ… ì•ˆì „í•œ ë¬¸ìì—´ ì—°ê²° -->
${"Total: " + (amount!0)?string}
```

### ğŸ“– ì£¼ì„ ë° ë¬¸ì„œí™”

#### 11. ì£¼ì„ ê·œì¹™

```ftl
<#-- 
    í…œí”Œë¦¿ ëª©ì : ì†¡ì¥ ë°œí–‰ìš© í…œí”Œë¦¿
    í•„ìˆ˜ ë³€ìˆ˜:
    - company: íšŒì‚¬ ì •ë³´ (ê°ì²´)
    - client: í´ë¼ì´ì–¸íŠ¸ ì •ë³´ (ê°ì²´)
    - items: í•­ëª© ë¦¬ìŠ¤íŠ¸ (ë°°ì—´)
    - invoiceNumber: ì†¡ì¥ ë²ˆí˜¸ (ë¬¸ìì—´)
-->

<#-- ë³µì¡í•œ ë¡œì§ì—ëŠ” ì„¤ëª… ì¶”ê°€ -->
<#assign totalAmount = 0>
<#list items as item>
    <#-- ê° í•­ëª©ì˜ ê¸ˆì•¡ ê³„ì‚° -->
    <#assign itemTotal = (item.quantity!0) * (item.price!0)>
    <#assign totalAmount = totalAmount + itemTotal>
</#list>
```

### ğŸ” ë³€ìˆ˜ ì¶”ì¶œì„ ìœ„í•œ íŠ¹ë³„ ê·œì¹™

#### 12. ë³€ìˆ˜ ì¶”ì¶œ ìµœì í™”

```ftl
<!-- âœ… ëª…ì‹œì  ë³€ìˆ˜ ì„ ì–¸ (ì¶”ì¶œí•˜ê¸° ì‰¬ì›€) -->
<#-- í•„ìˆ˜ ë³€ìˆ˜ ëª©ë¡ì„ ì£¼ì„ìœ¼ë¡œ ëª…ì‹œ -->
<#-- @variables: company, client, items, invoiceNumber, issueDate -->

<!-- âœ… ì¼ê´€ëœ ë„¤ì´ë° -->
${document.type}     <!-- documentType ëŒ€ì‹  -->
${document.number}   <!-- documentNumber ëŒ€ì‹  -->

<!-- âœ… ëª…í™•í•œ ê°ì²´ êµ¬ì¡° -->
${payment.terms}     <!-- paymentTerms ëŒ€ì‹  -->
${payment.info}      <!-- paymentInfo ëŒ€ì‹  -->
```

### âš ï¸ ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

#### 13. ì„±ëŠ¥ ìµœì í™”

```ftl
<!-- âœ… ë³€ìˆ˜ ìºì‹± -->
<#assign hasItems = items?? && items?has_content>
<#if hasItems>
    <!-- items ì‚¬ìš© -->
</#if>

<!-- âœ… ì¡°ê±´ ìµœì í™” -->
<#if company??>
    <#assign companyName = company.name!"ê¸°ë³¸ íšŒì‚¬ëª…">
    ${companyName}
</#if>

<!-- âŒ ë°˜ë³µ ê³„ì‚° -->
<#if items?? && items?has_content>
    ${items?size}
</#if>
<#if items?? && items?has_content>
    <!-- ê°™ì€ ì¡°ê±´ì„ ë°˜ë³µ ì²´í¬ -->
</#if>
```

### ğŸ¯ ë³€ìˆ˜ ì¶”ì¶œ ì¹œí™”ì  êµ¬ì¡°

#### 14. ê¶Œì¥ í…œí”Œë¦¿ êµ¬ì¡°

```ftl
<#-- 1. í—¤ë”: ë³€ìˆ˜ ëª©ë¡ê³¼ ì„¤ëª… -->
<#-- 
ë³€ìˆ˜ êµ¬ì¡°:
- document: {type, number, date}
- company: {name, address, phone, email}
- client: {name, address, phone, email}
- items: [{name, description, quantity, price}]
- totals: {subtotal, tax, total}
-->

<#-- 2. ë§¤í¬ë¡œ/í•¨ìˆ˜ ì •ì˜ -->
<#macro formatMoney amount>
    <!-- ë§¤í¬ë¡œ ë‚´ìš© -->
</#macro>

<#-- 3. ë³€ìˆ˜ ìœ íš¨ì„± ê²€ì¦ -->
<#if !document??>
    <#stop "document ë³€ìˆ˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.">
</#if>

<#-- 4. ë©”ì¸ í…œí”Œë¦¿ ë‚´ìš© -->
<!-- ì‹¤ì œ HTML ë‚´ìš© -->
```

---

## ğŸ’ ê²°ë¡  ë° ê¶Œì¥ì‚¬í•­

### ğŸ† Enhanced Mock Environmentì˜ ìš°ìˆ˜ì„±

#### í•µì‹¬ ì›ë¦¬

```
ì •ê·œì‹    â†’ ë¬¸ìì—´ íŒ¨í„´ ë§¤ì¹­ (í‘œë©´ì )
AST      â†’ êµ¬ë¬¸ êµ¬ì¡° ë¶„ì„ (êµ¬ì¡°ì )  
Mock Env â†’ ì‹¤ì œ ì‹¤í–‰ ì¶”ì  (ë™ì )
```

#### ì™œ ê°€ì¥ ì •í™•í•œê°€?

1. **FreeMarker ì—”ì§„ ìì²´ë¥¼ í™œìš©**: ëª¨ë“  FreeMarker ê¸°ëŠ¥ì„ ì™„ë²½ ì§€ì›
2. **ì‹¤í–‰ ê¸°ë°˜ ë¶„ì„**: ì •ì  ë¶„ì„ì˜ í•œê³„ë¥¼ ê·¹ë³µ
3. **ë‹¤ì¤‘ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸**: ëª¨ë“  ë¶„ê¸°ì™€ ê²½ìš°ì˜ ìˆ˜ ì»¤ë²„
4. **ì œë¡œ false positive**: FreeMarkerê°€ ì‹¤ì œë¡œ ì ‘ê·¼í•œ ê²ƒë§Œ ê¸°ë¡

#### ì„±ëŠ¥ê³¼ ì•ˆì •ì„±

- **ì„±ëŠ¥**: í…œí”Œë¦¿ì„ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•˜ì§€ë§Œ, ì‹¤ì œ HTML ìƒì„±í•˜ì§€ ì•Šì•„ ë¹ ë¦„
- **ì•ˆì •ì„±**: FreeMarker ê³µì‹ APIë§Œ ì‚¬ìš©í•˜ì—¬ ì•ˆì „
- **í™•ì¥ì„±**: ìƒˆë¡œìš´ FreeMarker ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì–´ë„ ìë™ ì§€ì›

### ğŸ¯ ì‹¤ë¬´ ì ìš© ê°€ì´ë“œ

#### êµ¬í˜„ ë‹¨ê³„

1. **ê¸°ë³¸ Mock Environment êµ¬í˜„**
2. **ë‹¤ì¤‘ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì¶”ê°€**
3. **í…œí”Œë¦¿ ì‘ì„± ê·œì¹™ ë„ì…**
4. **ìë™í™”ëœ ë³€ìˆ˜ ê²€ì¦ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**

#### ê¸°ëŒ€ íš¨ê³¼

- **99% ì´ìƒì˜ ë³€ìˆ˜ ì¶”ì¶œ ì •í™•ë„**
- **ëŸ°íƒ€ì„ ì˜¤ë¥˜ 90% ê°ì†Œ**
- **ê°œë°œ ìƒì‚°ì„± í–¥ìƒ**
- **í…œí”Œë¦¿ ì˜ì¡´ì„± ìë™ ë¬¸ì„œí™”**

### ğŸš€ ì¶”ê°€ ê¶Œì¥ì‚¬í•­

1. **í…œí”Œë¦¿ ê²€ì¦ íŒŒì´í”„ë¼ì¸** êµ¬ì¶•
2. **í‘œì¤€ ë³€ìˆ˜ ë„¤ì´ë° ì»¨ë²¤ì…˜** ë„ì…
3. **í…œí”Œë¦¿ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** ì‘ì„±
4. **ë³€ìˆ˜ ìŠ¤í‚¤ë§ˆ ë¬¸ì„œí™”** ìë™í™”
5. **IDE í”ŒëŸ¬ê·¸ì¸** ê°œë°œ (ìë™ì™„ì„±, ê²€ì¦)

### ğŸ“ˆ ROI ë¶„ì„

| ì˜ì—­            | ê¸°ì¡´ ë°©ì‹  | Enhanced Mock | ê°œì„  íš¨ê³¼         |
|---------------|--------|---------------|---------------|
| **ë³€ìˆ˜ ì¶”ì¶œ ì •í™•ë„** | 60-80% | 99%+          | ğŸš€ **25% í–¥ìƒ** |
| **ê°œë°œ ì‹œê°„**     | 100%   | 70%           | ğŸš€ **30% ë‹¨ì¶•** |
| **ëŸ°íƒ€ì„ ì˜¤ë¥˜**    | 100%   | 10%           | ğŸš€ **90% ê°ì†Œ** |
| **ìœ ì§€ë³´ìˆ˜ ë¹„ìš©**   | 100%   | 40%           | ğŸš€ **60% ì ˆì•½** |

---

## ğŸ“š ì°¸ê³  ìë£Œ

### FreeMarker ê³µì‹ ë¬¸ì„œ

- [FreeMarker Manual](https://freemarker.apache.org/docs/)
- [Built-in Reference](https://freemarker.apache.org/docs/ref_builtins.html)
- [Directive Reference](https://freemarker.apache.org/docs/ref_directive.html)

### ê´€ë ¨ ê¸°ìˆ 

- Template Model API
- Configuration API
- Environment API

### ì½”ë“œ ì €ì¥ì†Œ

- [ê¸°ì—…ìš© FreeMarker Variable Extractor](https://github.com/your-org/freemarker-extractor)
- [í…œí”Œë¦¿ ì‘ì„± ê°€ì´ë“œë¼ì¸](https://github.com/your-org/freemarker-guidelines)

---

**ì´ ê°€ì´ë“œë¥¼ í†µí•´ FreeMarker í…œí”Œë¦¿ì—ì„œ ë³€ìˆ˜ë¥¼ ì •í™•í•˜ê³  ì•ˆì „í•˜ê²Œ ì¶”ì¶œí•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤. Enhanced Mock Environment ë°©ì‹ì€ ê¸°ì—… í™˜ê²½ì—ì„œ ê²€ì¦ëœ ìµœê³ ì˜ ì†”ë£¨ì…˜ì…ë‹ˆë‹¤!** ğŸ¯